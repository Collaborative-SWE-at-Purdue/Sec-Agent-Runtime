## System Interaction Model

### Overview

The system consists of three main components:

- **User**: Provides high-level goals in natural language
- **Agent (LLM)**: The agent serves as a bidirectional interface between the user and the runtime.
- **Runtime**: Enforces policy and executes actions

The runtime treats the agent as **untrusted** and enforces strict validation and authorization on all actions.

---

### Interaction Flow

The overall interaction follows this flow:

User → Agent → Proposal → Runtime → Response → Agent → User

1. The user provides instruction in natural language
2. The agent (LLM) interprets the instruction and generates a structured proposal (JSON)
3. The proposal is sent to the runtime
4. The runtime validates, authorizes, and executes the request
5. The runtime returns a response
6. The agent interprets the response and may generate further proposals
7. The final result is returned to the user

---

### Roles and Responsibilities

#### User

- Provides high-level goals or instructions
- Does not directly interact with the runtime
- Does not construct proposals

#### Agent (LLM)

- Interprets user intent
- Generates structured proposals
- Acts as an **untrusted component**
- May produce incorrect or malicious outputs

#### Runtime

- Acts as a **security boundary** between the agent and the environment
- Treats the agent as untrusted
- Validates all incoming proposals against a strict schema
- Enforces policy using an allowlist and sandbox restrictions
- Executes only authorized actions
- Produces deterministic and auditable outcomes
For detailed processing logic, refer to the Step Lifecycle Phases section.


### Request–Response Model

The runtime follows a strict request–response model:

Agent → PROPOSAL → Runtime → RESPONSE → Agent

- Each proposal corresponds to exactly one step
- Each step produces exactly one response
- No partial or streaming responses are allowed

---

### Proposal

A proposal is a structured JSON payload generated by the agent.

Example:

```json
{
  "schema_version": "1.0.0",
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "reasoning": "Need to read configuration file",
  "action": "READ_FILE",
  "args": {
    "path": "/sandbox/config.txt"
  }
}

```

### Agent-to-User Response

The runtime returns structured JSON responses to the agent.

The agent translates these responses into human-readable output for the user.

Examples:

#### Successful Execution

```json
{
  "runtime_response": {
    "proposal_id": "123",
    "action": "READ_FILE",
    "outcome": "SUCCESS",
    "result": {
      "content": "Hello World"
    },
    "error": null
  },
  "agent_output": "The file content is:\n\nHello World"
}

```

#### Policy Denied

```json
{
  "runtime_response": {
    "proposal_id": "124",
    "action": "DELETE_FILE",
    "outcome": "DENIED",
    "result": null,
    "error": {
      "error_code": "POLICY_VIOLATION",
      "message": "Access outside /sandbox/ is not allowed"
    }
  },
  "agent_output": "The requested action is not allowed due to security restrictions."
}

```

#### Execution Error

```json
{
  "runtime_response": {
    "proposal_id": "125",
    "action": "READ_FILE",
    "outcome": "EXECUTION_ERROR",
    "result": null,
    "error": {
      "error_code": "EXECUTION_ERROR",
      "message": "File not found"
    }
  },
  "agent_output": "The file could not be found."
}
```

